import{b as z,u as T}from"./vue-router.13ff4542.js";import{u as M,_ as R,h as O,r as P}from"./index.82bb0ea4.js";import{u as q}from"./setting.7a705450.js";import{B as Y}from"./@element-plus.2f5a972a.js";import{E as F}from"./element-plus.57de7fca.js";import{d as S,r as V,w as D,a6 as m,o as C,c as H,_ as a,T as s,u as E,O as G,a as y,S as J,a3 as N,aA as K,aB as L,Y as Q}from"./@vue.acab0428.js";import{E as W}from"./@tinymce.4db9fcd2.js";import{g as X,b as Z,c as ee,f as te}from"./news.9959d1d4.js";import"./pinia.cc224967.js";import"./path-browserify.12fd8122.js";import"./axios.c0d44eb0.js";import"./lodash-es.082cdea4.js";import"./@vueuse.60d5afff.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./dayjs.180da8d0.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.cba15af0.js";const le={class:"file-upload"},oe=["src"],ae=S({__name:"ImgUpload",props:{modelValue:{type:String},accept:{default:".jpg,.jpeg,.png,.gif"},limit:{default:5}},emits:["update:modelValue"],setup(i,{emit:b}){const I=i,f=M(),p=q(),U={token:f.getUserInfo.token},u=V([]);D(()=>I.modelValue,e=>{e&&(u.value=e.split(",").map(o=>({url:p.getFileHost+o})))},{immediate:!0});const h=e=>{if((e.type=="image/png"||e.type=="image/jpg"||e.type=="image/jpeg"||e.type=="image/gif")&&e.size/1024/1024>=10)return F.warning("\u56FE\u7247\u6700\u592710M"),!1},l=(e,o,t)=>{console.log("handleImgSuccess",e,o,t),B(t)},v=(e,o,t)=>{console.log("handleImgError",e,o,t),F.error("\u903B\u8F91\u5904\u7406\u9519\u8BEF")},g=(e,o)=>{console.log("handleImgRemove",e,o),B(o)},k=(e,o)=>{console.log("handleImgExceed",e,o),F.warning(`\u6700\u591A${I.limit}\u5F20\u56FE\u7247\u2190_\u2190`)},B=e=>{for(let n=0;n<e.length;n++)if(e[n].status!=="success")return;const o=p.getFileHost,t=[];for(let n=0;n<e.length;n++)if(e[n].response)t.push(e[n].response.data);else{let w=e[n].url;w.indexOf(o)!==-1&&(w=w.replace(o,"")),t.push(w)}b("update:modelValue",t.toString())},c=V(!1),r=V(""),d=e=>{r.value=e.url,c.value=!0};return(e,o)=>{const t=m("el-icon"),n=m("el-upload"),w=m("el-dialog");return C(),H("div",le,[a(n,{class:G({hide:u.value.length>=i.limit}),action:"/api/common/uploadFile",headers:U,"list-type":"picture-card",accept:i.accept,multiple:!0,limit:i.limit,"file-list":u.value,"before-upload":h,"on-preview":d,"on-success":l,"on-error":v,"on-remove":g,"on-exceed":k},{default:s(()=>[a(t,null,{default:s(()=>[a(E(Y))]),_:1})]),_:1},8,["class","accept","limit","file-list"]),a(w,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=x=>c.value=x)},{default:s(()=>[y("img",{src:r.value,alt:"",style:{width:"100%"}},null,8,oe)]),_:1},8,["modelValue"])])}}});const ne=R(ae,[["__scopeId","data-v-ca215029"]]);function se(i){return O.request({url:"/api/common/uploadFile",method:"post",data:i})}const ue=S({__name:"RichText",props:{modelValue:{},height:{default:400}},emits:["update:modelValue"],setup(i,{emit:b}){const I=i,f=q(),p=V(I.modelValue);D(()=>p,u=>{b("update:modelValue",u)},{immediate:!0});const U=(u,h,l)=>{const v=new FormData;v.set("file",u.blob()),se(v).then(g=>{h(f.getFileHost+g.data)}).catch(g=>{l("error")})};return(u,h)=>(C(),J(E(W),{"api-key":"5s4j3k5n6oy09l6e7fsw2vzug5ruleqgdcoez1189b92ctvb",init:{height:i.height,menubar:!1,plugins:"lists link image help wordcount",toolbar:"undo redo | blocks | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | help image",images_upload_handler:(l,v,g)=>{U(l,v,g)}},modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=l=>p.value=l)},null,8,["init","modelValue"]))}});function re(){P.go(-1)}const j=i=>(K("data-v-ec824b21"),i=i(),L(),i),ie={class:"wrapper"},de={class:"page-head"},ce=j(()=>y("div",{class:"r"},null,-1)),me={class:"news-edit"},pe=Q("\u4FDD\u5B58"),ge=j(()=>y("div",null,null,-1)),_e=S({__name:"newsEdit",setup(i){const b=z(),I=T(),f=I.query.id,p=V([]);(()=>{X().then(c=>{p.value=c.data,f&&h()})})();const u=V([]),h=()=>{Z(f).then(c=>{for(const t in l)t!=="cateId"&&(l[t]=c.data[t]);const r=c.data.cateId,d=[];let e=!1;function o(t){for(let n=0;n<t.length&&!e;n++)t[n].id===r?(d.push(t[n].id),e=!0):t[n].children&&t[n].children.length>0?(d.push(t[n].id),o(t[n].children)):n===t.length-1&&d.pop()}o(p.value),u.value=d,l.cateId=d[d.length-1]})},l=N({title:"",imgUrl:"",cateId:void 0,content:"",type:0,status:0}),v=N({title:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"blur"}],imgUrl:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"blur"}],cateId:[{required:!0,message:"\u8BF7\u9009\u62E9",trigger:"blur"}],content:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"blur"}]}),g=V(),k=()=>{Array.isArray(u.value)?u.value.length>0?l.cateId=u.value[u.value.length-1]:l.cateId=void 0:u.value===null&&(l.cateId=void 0)},B=()=>{var c;(c=g.value)==null||c.validate(r=>{r&&(f?(l.id=f,ee(l).then(d=>{F.success(d.msg),b.push({path:"newsList"})})):te(l).then(d=>{F.success(d.msg),b.push({path:"newsList"})}))})};return(c,r)=>{const d=m("el-page-header"),e=m("el-input"),o=m("el-form-item"),t=m("el-col"),n=m("el-cascader"),w=m("el-switch"),x=m("el-button"),A=m("el-row"),$=m("el-form");return C(),H("div",ie,[y("div",de,[a(d,{title:"\u8FD4\u56DE",content:E(I).meta.title,onBack:E(re)},null,8,["content","onBack"]),ce]),y("div",me,[a($,{ref_key:"newsFormRef",ref:g,model:l,rules:v,"label-width":"auto"},{default:s(()=>[a(A,null,{default:s(()=>[a(t,{span:24},{default:s(()=>[a(o,{label:"\u6807\u9898",prop:"title"},{default:s(()=>[a(e,{modelValue:l.title,"onUpdate:modelValue":r[0]||(r[0]=_=>l.title=_),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:12},{default:s(()=>[a(o,{label:"\u5206\u7C7B",prop:"cateId"},{default:s(()=>[a(n,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=_=>u.value=_),options:p.value,props:{value:"id",label:"name",children:"children",checkStrictly:!0,expandTrigger:"hover"},onChange:k,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),a(t,{span:12},{default:s(()=>[a(o,{label:"\u72B6\u6001",prop:"status"},{default:s(()=>[a(w,{modelValue:l.status,"onUpdate:modelValue":r[2]||(r[2]=_=>l.status=_),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:24},{default:s(()=>[a(o,{label:"\u56FE\u7247",prop:"imgUrl"},{default:s(()=>[a(ne,{modelValue:l.imgUrl,"onUpdate:modelValue":r[3]||(r[3]=_=>l.imgUrl=_),limit:5},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:24},{default:s(()=>[a(o,{label:"\u5185\u5BB9",prop:"content"},{default:s(()=>[a(ue,{modelValue:l.content,"onUpdate:modelValue":r[4]||(r[4]=_=>l.content=_)},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:24},{default:s(()=>[a(o,null,{default:s(()=>[a(x,{type:"primary",onClick:B},{default:s(()=>[pe]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),ge])}}});const je=R(_e,[["__scopeId","data-v-ec824b21"]]);export{je as default};
